#!/usr/bin/python
#
# Copyright I.T. Dev Ltd 2014
# http://www.itdev.co.uk
#


import sys
import argparse
import socket

sys.path.insert(0, '/usr/lib')
from mcvirt.mcvirt import McVirtException
from mcvirt.parser import Parser
from mcvirt.auth import Auth

if __name__ == "__main__":

  parser_object = Parser()

  try:
    # Ensure that the user is running McVirt as root/sudo
    Auth.checkRootPrivileges()
  except McVirtException, e:
    print e.message
    sys.exit(1)

  if (len(sys.argv) > 1):
    try:
      parser_object.parse_arguments()
    except McVirtException, e:
      print e.message
      sys.exit(1)
  else:
    while (1):
      sys.stdout.write('mcvirt@%s> ' % socket.gethostname())
      command = sys.stdin.readline().rstrip().lstrip()
      if (command == 'exit'):
        sys.exit()
      else:
        try:
          parser_object.parse_arguments(command)
        except McVirtException, e:
          print e.message
